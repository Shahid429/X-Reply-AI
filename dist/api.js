export async function withTimeoutFetch(t,e,o=8e3){const n=new AbortController,s=setTimeout(()=>n.abort(),o);try{return await fetch(t,{...e,signal:n.signal})}finally{clearTimeout(s)}}export async function callGemini(t,e,o,n){const s=`https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(e)}:generateContent?key=${t}`,a=await withTimeoutFetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:o},{text:n}]}],generationConfig:{temperature:.7,maxOutputTokens:60,topP:.8,topK:40}})});if(!a.ok){let t=`HTTP ${a.status}`;try{const e=await a.json();t=e.error?.message||t}catch{}throw new Error(t)}const r=await a.json();return{text:r.candidates?.[0]?.content?.parts?.[0]?.text?.trim()||""}}export async function callOpenAI(t,e,o,n){const s=await withTimeoutFetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:e,temperature:.7,max_tokens:60,messages:[{role:"system",content:o},{role:"user",content:n}]})});if(!s.ok){let t=`HTTP ${s.status}`;try{const e=await s.json();t=e.error?.message||t}catch{}throw new Error(t)}const a=await s.json(),r=a.choices?.[0]?.message?.content?.trim()||"",i=a.usage?.prompt_tokens,c=a.usage?.completion_tokens;return{text:r,inputTokens:i,outputTokens:c}}export async function callPerplexity(t,e,o,n){const s=await withTimeoutFetch("https://api.perplexity.ai/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:e,temperature:.7,max_tokens:60,messages:[{role:"system",content:o},{role:"user",content:n}]})});if(!s.ok){let t=`HTTP ${s.status}`;try{const e=await s.json();t=e.error?.message||t}catch{}throw new Error(t)}const a=await s.json(),r=a.choices?.[0]?.message?.content?.trim()||"",i=a.usage?.prompt_tokens,c=a.usage?.completion_tokens;return{text:r,inputTokens:i,outputTokens:c}}