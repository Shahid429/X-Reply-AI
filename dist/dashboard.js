function e(){chrome.storage.local.get(["dashboardStats"],function(e){const t=e.dashboardStats||{dailyReplies:0,monthlyReplies:0,dailyTokens:0,monthlyTokens:0,lastUpdated:Date.now()},n=new Date(t.lastUpdated),o=new Date;n.toDateString()!==o.toDateString()&&(t.dailyReplies=0,t.dailyTokens=0),n.getMonth()===o.getMonth()&&n.getFullYear()===o.getFullYear()||(t.monthlyReplies=0,t.monthlyTokens=0),document.getElementById("dailyReplies").textContent=t.dailyReplies,document.getElementById("monthlyReplies").textContent=t.monthlyReplies,document.getElementById("dailyTokens").textContent=t.dailyTokens.toLocaleString(),document.getElementById("monthlyTokens").textContent=t.monthlyTokens.toLocaleString(),chrome.storage.local.set({dashboardStats:t})}),chrome.storage.local.get(["replyHistory"],function(e){const n=e.replyHistory||[],o=document.getElementById("replyHistory");if(0===n.length)return;o.innerHTML="",n.slice(-10).reverse().forEach(e=>{const n=t(e);o.appendChild(n)});const a=document.getElementById("loadMore");n.length>10?a.style.display="inline-block":a.style.display="none"})}function t(e){const t=document.createElement("div");t.className="reply-item";const o=new Date(e.timestamp).toLocaleString(),a=e.model||"Unknown",l=e.tokens||0;t.innerHTML=`\n    <div class="reply-header">\n      <span class="reply-time">${o}</span>\n      <span class="reply-model">${a}</span>\n      <span class="reply-tokens">📊 ${l} tokens</span>\n    </div>\n    <div class="reply-content">${function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}(e.content)}</div>\n    <div class="reply-actions">\n      <span class="reply-action copy-btn">📋 Copy</span>\n    </div>\n  `;return t.querySelector(".copy-btn").addEventListener("click",function(){n(e.content)}),t}function n(e){navigator.clipboard.writeText(e).then(function(){o("Reply copied to clipboard!","success")}).catch(function(e){console.error("Failed to copy: ",e),o("Failed to copy to clipboard.","error")})}function o(e,t="info"){const n=document.createElement("div");n.className=`notification ${t}`,n.innerHTML=`\n    <div class="notification-content">\n      <span id="notification-text">${e}</span>\n      <button id="notification-close" class="notification-close">&times;</button>\n    </div>\n  `,document.body.appendChild(n);n.querySelector("#notification-close").addEventListener("click",()=>{n.remove()}),setTimeout(()=>{n.parentNode&&n.remove()},3e3)}document.addEventListener("DOMContentLoaded",function(){console.log("Dashboard loaded successfully"),e(),function(){document.getElementById("clearData").addEventListener("click",function(t){t.preventDefault(),confirm("Are you sure you want to clear all dashboard data? This action cannot be undone.")&&chrome.storage.local.set({dashboardStats:{dailyReplies:0,monthlyReplies:0,dailyTokens:0,monthlyTokens:0,lastUpdated:Date.now()},replyHistory:[]},function(){e(),o("All dashboard data has been cleared.","success")})});document.getElementById("searchInput").addEventListener("input",function(){!function(e){const t=document.querySelectorAll(".reply-item"),n=e.toLowerCase();t.forEach(e=>{const t=e.querySelector(".reply-content").textContent.toLowerCase(),o=e.querySelector(".reply-model").textContent.toLowerCase(),a=t.includes(n)||o.includes(n);e.style.display=a?"block":"none"})}(this.value)});document.getElementById("exportData").addEventListener("click",function(){chrome.storage.local.get(["replyHistory","dashboardStats"],function(e){const t={stats:e.dashboardStats||{},history:e.replyHistory||[],exportedAt:(new Date).toISOString()},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=URL.createObjectURL(n),l=document.createElement("a");l.href=a,l.download=`x-reply-ai-dashboard-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a),o("Dashboard data exported successfully!","success")})});document.getElementById("loadMore").addEventListener("click",function(){!function(){const e=document.getElementById("replyHistory"),n=e.querySelectorAll(".reply-item").length;chrome.storage.local.get(["replyHistory"],function(o){const a=o.replyHistory||[],l=a.slice(n,n+5);l.forEach(n=>{const o=t(n);e.appendChild(o)}),n+l.length>=a.length&&(document.getElementById("loadMore").style.display="none")})}()})}(),function(){const e=document.getElementById("themeToggle");"dark"===(localStorage.getItem("dashboardTheme")||"light")?(document.body.classList.add("dark-theme"),e.textContent="☀️",e.setAttribute("aria-label","Switch to light theme")):(e.textContent="🌙",e.setAttribute("aria-label","Switch to dark theme"));e.addEventListener("click",()=>{const t=document.body.classList.toggle("dark-theme");e.textContent=t?"☀️":"🌙",e.setAttribute("aria-label",t?"Switch to light theme":"Switch to dark theme"),localStorage.setItem("dashboardTheme",t?"dark":"light")})}()}),window.copyToClipboard=n,window.testTrackingFromDashboard=function(){console.log("Testing tracking from dashboard..."),chrome.runtime.sendMessage({type:"test-tracking"},e=>{console.log("Test tracking response:",e)})};